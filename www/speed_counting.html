<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speed Counting Trainer (Premium)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: linear-gradient(to bottom, #0b6623, #084f1a);
            color: white;
            padding: 20px;
            margin: 0;
            position: relative;
            min-height: 100vh;
            touch-action: manipulation;
        }
        #game {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(0,0,0,0.4);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
        }
        h1 {
            font-size: 28px;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px black;
        }
        .section {
            margin: 30px 0;
        }
        .cards {
            display: flex;
            justify-content: center;
            min-height: 180px;
            gap: 15px;
            flex-wrap: wrap;
            padding: 10px;
        }
        .card-img {
            max-width: 100%;
            height: auto;
            max-height: 160px;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.6);
        }
        button {
            background: linear-gradient(to bottom, #d4af37, #c3992a);
            color: white;
            border: none;
            padding: 16px 32px;
            margin: 12px;
            font-size: 20px;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            min-width: 200px;
        }
        button:hover {
            background: linear-gradient(to bottom, #e6c54a, #d4af37);
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(1px);
        }
        select, input[type=number] {
            padding: 14px;
            font-size: 18px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            margin: 15px auto;
            display: block;
            border: 2px solid gold;
        }
        /* Perfect Circle Settings Button - Fixed for original gear emoji */
        #settings-btn {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 200;
            background: linear-gradient(to bottom, #e6b800, #c3992a);
            color: white;
            font-size: 28px;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.6);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            border: none;
            overflow: hidden; /* Prevents emoji overflow */
        }
        #settings-btn::before {
            content: '⚙️';
            display: block;
            transform: scaleX(0.85); /* Squishes the wide emoji horizontally to fit perfectly */
        }
        #settings-btn:hover {
            background: linear-gradient(to bottom, #ffcc00, #d4af37);
            transform: scale(1.1);
        }
        /* Settings Menu */
        #settings-menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 35px;
            border-radius: 20px;
            z-index: 100;
            border: 4px solid gold;
            width: 90%;
            max-width: 550px;
            box-sizing: border-box;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }
        #settings-menu h2 {
            color: gold;
            margin-top: 0;
        }
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 30px;
            text-align: left;
        }
        @media (min-width: 600px) {
            .settings-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        .setting-item label {
            font-size: 20px;
            font-weight: bold;
            color: gold;
            display: block;
            margin-bottom: 10px;
        }
        .setting-item input[type=range] {
            width: 100%;
            height: 50px;
            accent-color: gold;
        }
        .setting-item span {
            display: block;
            text-align: center;
            margin-top: 10px;
            font-size: 22px;
            color: gold;
        }
        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 99;
        }
        #feedback {
            font-size: 32px;
            margin: 30px;
            min-height: 60px;
            font-weight: bold;
        }
        #omitted-reveal {
            font-size: 26px;
            margin: 30px 0;
            min-height: 200px;
        }
        #back-to-menu {
            margin-top: 50px;
            background: linear-gradient(to bottom, #aaa, #888);
            font-size: 22px;
            padding: 18px 36px;
        }
        #back-to-menu:hover {
            background: linear-gradient(to bottom, #ccc, #aaa);
        }
        p {
            font-size: 20px;
            margin: 20px 0;
        }
        /* Mobile Optimizations */
        @media (max-width: 768px) {
            h1 {
                font-size: 24px;
            }
            .card-img {
                max-height: 120px;
            }
            button {
                padding: 18px 36px;
                font-size: 22px;
                min-width: 80%;
            }
            #settings-btn {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
            #feedback {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
<!-- Perfect Circle Settings Button with original gear emoji (fixed) -->
<button id="settings-btn" title="Settings"></button>
<!-- Overlay & Settings Menu -->
<div id="overlay"></div>
<div id="settings-menu">
    <h2>Speed Counting Settings</h2>
    <div class="settings-grid">
        <div class="setting-item">
            <label>Card Display Speed (ms)</label>
            <input type="range" id="default-speed" min="200" max="2000" value="800" step="100">
            <span id="default-speed-value">800 ms</span>
        </div>
    </div>
    <button id="apply-settings-btn">Apply & Close</button>
</div>
<div id="game">
    <h1>Speed Counting Trainer (Premium)</h1>
    <div class="section">
        <label>Mode:</label><br>
        <select id="mode-select">
            <option value="batch">Batch Mode (5-10 cards at once)</option>
            <option value="deck">Deck Mode (guess omitted card)</option>
        </select>
    </div>
    <div class="section">
        <p>Correct: <span id="correct">0</span> | Total: <span id="total">0</span> | Accuracy: <span id="accuracy">0%</span></p>
    </div>
    <div class="section" id="batch-controls">
        <button id="start-batch">Start New Batch</button>
    </div>
    <div class="section" id="deck-controls" style="display:none;">
        <button id="start-deck">Start Full Deck</button>
    </div>
    <div class="section cards" id="cards-display"></div>
    <div class="section" id="guess-section" style="display:none;">
        <p id="prompt">What is the running count?</p>
        <input type="number" id="guess-input" placeholder="Enter value">
        <button id="submit-guess">Submit Guess</button>
        <div id="feedback"></div>
        <div id="omitted-reveal"></div>
    </div>
    <button id="back-to-menu" onclick="location.href='index.html'">← Back to Menu</button>
</div>
<script>
// (JavaScript unchanged)
const suits = ['♠', '♥', '♦', '♣'];
const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
let fullDeck = [];
let omittedCard = null;
let omittedValue = 0;
let correct = 0;
let total = 0;
let mode = 'batch';
let cardDelay = 800;
let currentTimeout = null;
function createFullDeck() {
    fullDeck = [];
    suits.forEach(s => ranks.forEach(r => fullDeck.push(r + s)));
    fullDeck.sort(() => Math.random() - 0.5);
}
function getHiLoValue(card) {
    const r = card.slice(0, -1);
    if (['2','3','4','5','6'].includes(r)) return 1;
    if (['10','J','Q','K','A'].includes(r)) return -1;
    return 0;
}
function getCardImageHTML(card) {
    const suitMap = { '♠': 'spades', '♥': 'hearts', '♦': 'diamonds', '♣': 'clubs' };
    const rankMap = { 'A': 'ace', 'J': 'jack', 'Q': 'queen', 'K': 'king' };
    const r = card.slice(0, -1);
    const s = card.slice(-1);
    const fileName = `${rankMap[r] || r}_of_${suitMap[s]}.svg`.toLowerCase();
    return `<img src="cards/${fileName}" class="card-img" alt="${card}">`;
}
function updateAccuracy() {
    const pct = total === 0 ? 0 : Math.round((correct / total) * 100);
    document.getElementById('accuracy').innerText = `${pct}%`;
    document.getElementById('correct').innerText = correct;
    document.getElementById('total').innerText = total;
}
function startBatch() {
    if (currentTimeout) {
        clearTimeout(currentTimeout);
        currentTimeout = null;
    }
    createFullDeck();
    const numCards = Math.floor(Math.random() * 6) + 5;
    const shownCards = fullDeck.slice(0, numCards);
    const runningCount = shownCards.reduce((sum, c) => sum + getHiLoValue(c), 0);
    document.getElementById('cards-display').innerHTML = shownCards.map(getCardImageHTML).join('');
    document.getElementById('prompt').innerText = 'What is the running count for these cards?';
    document.getElementById('guess-section').style.display = 'block';
    document.getElementById('feedback').innerText = '';
    document.getElementById('omitted-reveal').innerHTML = '';
    document.getElementById('guess-input').value = '';
    document.getElementById('guess-input').focus();
    window.expectedValue = runningCount;
}
function startDeckMode() {
    if (currentTimeout) {
        clearTimeout(currentTimeout);
        currentTimeout = null;
    }
    createFullDeck();
    const omitIndex = Math.floor(Math.random() * 52);
    omittedCard = fullDeck.splice(omitIndex, 1)[0];
    omittedValue = getHiLoValue(omittedCard);
    document.getElementById('cards-display').innerHTML = '';
    document.getElementById('guess-section').style.display = 'none';
    document.getElementById('feedback').innerText = '';
    document.getElementById('omitted-reveal').innerHTML = '';
    nextCardInDeck();
}
function nextCardInDeck() {
    if (fullDeck.length === 0) {
        document.getElementById('prompt').innerText = 'One card was omitted. What was its Hi-Lo value? (+1, 0, or -1)';
        document.getElementById('guess-section').style.display = 'block';
        document.getElementById('guess-input').value = '';
        document.getElementById('guess-input').focus();
        currentTimeout = null;
        return;
    }
    const card = fullDeck.pop();
    document.getElementById('cards-display').innerHTML = getCardImageHTML(card);
    currentTimeout = setTimeout(nextCardInDeck, cardDelay);
}
function checkGuess() {
    const guess = parseInt(document.getElementById('guess-input').value) || 0;
    const expected = mode === 'batch' ? window.expectedValue : omittedValue;
    total++;
    if (guess === expected) {
        correct++;
        document.getElementById('feedback').innerText = '✓ Correct!';
        document.getElementById('feedback').style.color = 'lime';
    } else {
        document.getElementById('feedback').innerText = `✗ Wrong! Was ${expected}`;
        document.getElementById('feedback').style.color = 'red';
    }
    updateAccuracy();
    if (mode === 'deck' && omittedCard) {
        document.getElementById('omitted-reveal').innerHTML =
            `<p>The omitted card was:</p>` + getCardImageHTML(omittedCard) +
            `<p>Hi-Lo value: <strong>${omittedValue}</strong></p>`;
    } else {
        document.getElementById('omitted-reveal').innerHTML = '';
    }
    document.getElementById('guess-input').value = '';
    document.getElementById('guess-input').focus();
    if (mode === 'batch') {
        setTimeout(() => {
            document.getElementById('feedback').innerText = '';
            startBatch();
        }, 3000);
    } else {
        document.getElementById('feedback').innerText = '';
    }
}
// Settings
document.getElementById('settings-btn').onclick = () => {
    document.getElementById('settings-menu').style.display = 'block';
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('default-speed').value = cardDelay;
    document.getElementById('default-speed-value').innerText = `${cardDelay} ms`;
};
document.getElementById('apply-settings-btn').onclick = () => {
    cardDelay = parseInt(document.getElementById('default-speed').value);
    document.getElementById('settings-menu').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
};
document.getElementById('overlay').onclick = () => {
    document.getElementById('settings-menu').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
};
document.getElementById('default-speed').oninput = function() {
    document.getElementById('default-speed-value').innerText = `${this.value} ms`;
};
// Mode switch
document.getElementById('mode-select').onchange = function() {
    mode = this.value;
    document.getElementById('batch-controls').style.display = mode === 'batch' ? 'block' : 'none';
    document.getElementById('deck-controls').style.display = mode === 'deck' ? 'block' : 'none';
    document.getElementById('cards-display').innerHTML = '';
    document.getElementById('guess-section').style.display = 'none';
    document.getElementById('omitted-reveal').innerHTML = '';
    document.getElementById('feedback').innerText = '';
    if (currentTimeout) {
        clearTimeout(currentTimeout);
        currentTimeout = null;
    }
};
document.getElementById('start-batch').onclick = startBatch;
document.getElementById('start-deck').onclick = startDeckMode;
document.getElementById('submit-guess').onclick = checkGuess;
document.getElementById('guess-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') checkGuess();
});
updateAccuracy();
</script>
</body>
</html>
