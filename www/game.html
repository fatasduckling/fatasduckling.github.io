<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Blackjack Hi-Lo Counting Trainer</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            text-align: center;
            background: linear-gradient(to bottom, #0b6623, #084f1a);
            color: white;
            padding: 15px;
            margin: 0;
            min-height: 100vh;
            touch-action: manipulation;
        }
        #game {
            max-width: 100%;
            margin: 0 auto;
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
        }
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px black;
        }
        .section { margin: 20px 0; }
        .stats {
            font-size: 18px;
            margin: 15px 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .cards {
            display: flex;
            justify-content: center;
            min-height: 130px;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        .card-img {
            max-height: 130px;
            width: auto;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.7);
            transition: transform 0.2s;
        }
        .card-img:hover {
            transform: scale(1.05);
        }
        button {
            background: #777;
            color: white;
            border: none;
            padding: 14px 24px;
            margin: 8px;
            font-size: 19px;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            min-width: 110px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
            transition: all 0.2s;
        }
        button:hover { opacity: 0.9; transform: translateY(-2px); }
        button.correct {
            background: linear-gradient(to bottom, #00ff00, #009900) !important;
            box-shadow: 0 6px 12px rgba(0,255,0,0.5);
        }
        button.deviation {
            background: linear-gradient(to bottom, #ffaa00, #cc7700) !important;
            box-shadow: 0 6px 12px rgba(255,170,0,0.5);
        }
        /* Perfect Circle Settings Button - Fixed */
        #settings-btn {
            position: fixed;
            top: 12px;
            right: 12px;
            z-index: 200;
            background: linear-gradient(to bottom, #e6b800, #c3992a);
            color: white;
            font-size: 28px;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.6);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            border: none;
            line-height: 1;
        }
        #settings-btn:hover {
            background: linear-gradient(to bottom, #ffcc00, #d4af37);
            transform: scale(1.1);
        }
        /* Settings Menu Scrollable on Mobile */
        #settings-menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 30px;
            border-radius: 20px;
            z-index: 100;
            border: 4px solid gold;
            width: 90%;
            max-width: 520px;
            max-height: 90vh;
            overflow-y: auto;
            box-sizing: border-box;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }
        #settings-menu::-webkit-scrollbar {
            width: 8px;
        }
        #settings-menu::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }
        #settings-menu::-webkit-scrollbar-thumb {
            background: gold;
            border-radius: 10px;
        }
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 25px;
            text-align: left;
        }
        @media (min-width: 600px) {
            .settings-grid { grid-template-columns: repeat(2, 1fr); }
        }
        .setting-item label {
            font-size: 17px;
            font-weight: bold;
            color: gold;
            display: block;
            margin-bottom: 6px;
        }
        .setting-item select, .setting-item input {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            font-size: 17px;
            border-radius: 8px;
            border: none;
            background: #333;
            color: white;
        }
        #overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 99;
        }
        #back-to-menu {
            margin-top: 40px;
            background: #666;
            font-size: 20px;
            padding: 16px 32px;
            border-radius: 12px;
        }
        #back-to-menu:hover { background: #888; }
        #feedback {
            min-height: 50px;
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 2px 4px black;
        }
        input#bet-input {
            width: 100px;
            padding: 12px;
            font-size: 19px;
            border-radius: 8px;
            border: none;
            background: #333;
        }
        .hand-label {
            font-size: 20px;
            margin: 15px 0 10px;
            font-weight: bold;
        }
        #count-accuracy { font-size: 16px; }
        @media (max-width: 480px) {
            .card-img { max-height: 110px; }
            button { padding: 12px 18px; font-size: 17px; min-width: 90px; }
            h1 { font-size: 24px; }
            #settings-btn {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
<!-- Perfect Circle Settings Button -->
<button id="settings-btn" title="Settings">⚙️</button>

<div id="overlay"></div>
<div id="settings-menu">
    <h2>Game Settings</h2>
    <div class="settings-grid">
        <div class="setting-item">
            <label>Number of Simultaneous Hands:</label>
            <select id="num-hands">
                <option value="1" selected>1 Hand</option>
                <option value="2">2 Hands</option>
            </select>
        </div>
        <div class="setting-item">
            <label>Double After Split:</label>
            <select id="das">
                <option value="true" selected>Allowed</option>
                <option value="false">Not Allowed</option>
            </select>
        </div>
        <div class="setting-item">
            <label>Counting Trainer:</label>
            <select id="counting-on">
                <option value="true" selected>On (Deviations)</option>
                <option value="false">Off (Basic Only)</option>
            </select>
        </div>
        <div class="setting-item">
            <label>Guess Count:</label>
            <select id="guess-count-on">
                <option value="true" selected>Every Round</option>
                <option value="false">Disabled</option>
            </select>
        </div>
        <div class="setting-item">
            <label>Decks:</label>
            <select id="num-decks">
                <option value="1" selected>1</option>
                <option value="2">2</option>
                <option value="6">6</option>
                <option value="8">8</option>
            </select>
        </div>
        <div class="setting-item">
            <label>Dealer Soft 17:</label>
            <select id="soft17">
                <option value="true" selected>Hits</option>
                <option value="false">Stands</option>
            </select>
        </div>
        <div class="setting-item">
            <label>Late Surrender:</label>
            <select id="surrender">
                <option value="true" selected>Enabled</option>
                <option value="false">Disabled</option>
            </select>
        </div>
        <div class="setting-item">
            <label>Blackjack Payout:</label>
            <select id="bj-payout">
                <option value="1.5" selected>3:2</option>
                <option value="1.2">6:5</option>
            </select>
        </div>
        <div class="setting-item">
            <label>Starting Bankroll ($):</label>
            <input type="number" id="starting-bankroll" value="5000">
        </div>
    </div>
    <button id="apply-settings-btn">Apply & Close</button>
</div>

<div id="game">
    <h1>Hi-Lo Counting Trainer</h1>
 
    <div class="section stats">
        <div>Bankroll: $<span id="bankroll">5000</span></div>
        <div>Decks Left: <span id="decks-left">1.0</span></div>
        <div>True Count: <span id="true-count">0.0</span></div>
    </div>
    <div class="section">
        <p id="play-accuracy" style="font-size:20px;font-weight:bold;">Correct plays: 0/0 (0%)</p>
        <p id="bet-suggestion" style="font-size:18px;">Suggested bet: $25 (1 unit)</p>
    </div>
    <div class="section">
        <p>
            Bet per hand: $<input type="number" id="bet-input" value="25" min="5" step="5">
            <button id="deal-button">Deal Hand(s)</button>
        </p>
    </div>
    <div class="section">
        <h2>Dealer: <span id="dealer-total">?</span></h2>
        <div id="dealer-cards" class="cards"></div>
    </div>
    <div id="player-hands-container"></div>
    <div id="insurance-actions" class="section" style="display:none;">
        <p style="color:orange; font-size:1.3em;font-weight:bold;">Dealer shows Ace – Insurance?</p>
        <button id="insurance-yes">Yes</button>
        <button id="insurance-no">No</button>
    </div>
    <div id="actions" class="section" style="display:none;"></div>
    <div class="section">
        <p id="feedback">Ready — press Deal</p>
    </div>
    <div id="end-round" style="display:none;" class="section">
        <h2>End of Round - Running Count Guess</h2>
        <p>Count accuracy: <span id="count-accuracy">0/0 (0%)</span></p>
        <input type="number" id="count-guess" placeholder="Enter Running Count" style="padding:10px; font-size:18px; width:120px;">
        <button id="check-count-btn">Submit Guess</button>
        <p id="count-feedback"></p>
    </div>
    <button id="back-to-menu" onclick="location.href='index.html'">← Back to Menu</button>
</div>

<script>
// (All JavaScript remains unchanged from previous version)
let deck = [];
let dealerHand = [];
let playerHands = [];
let currentHandIndex = 0;
let seenCards = [];
let bankroll = 5000, baseUnit = 25, betPerHand = 25;
let gamePhase = 'betting';
let totalDecisions = 0, correctDecisions = 0, totalCountGuesses = 0, correctCountGuesses = 0;
let numDecks = 1, dealerHitsSoft17 = true, surrenderEnabled = true, bjPayout = 1.5;
let countingEnabled = true, guessCountEnabled = true, doubleAfterSplit = true;
let numSimultaneousHands = 1;
const suits = ['♠', '♥', '♦', '♣'];
const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
const illustrious18 = {
    insurance: 3,
    '16vs10': 0,
    '15vs10': 4,
    '11vsA': 1,
    '10vs10': 4,
    '10vsA': 3,
    '12vs3': 2,
    '12vs2': 3,
    '9vs2': 1,
    '9vs7': 3,
    '8vs6': 2,
    '13vs2': -1,
    '12vs4': 0,
    '12vs5': -1,
    '12vs6': -2,
    '1010vs5': 5,
    '1010vs6': 4,
    '16vs9': 5
};
const fab4 = {
    '15vs9': 3,
    '15vs10': 0,
    '15vsA': 2,
    '14vs10': 4
};
function createDeck() {
    deck = [];
    for (let d = 0; d < numDecks; d++) {
        for (let s of suits) for (let r of ranks) deck.push(r + s);
    }
    shuffle(deck);
    seenCards = [];
}
function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}
function dealCard(toArray) {
    if (deck.length < 20) createDeck();
    const card = deck.pop();
    toArray.push(card);
    seenCards.push(card);
    return card;
}
function rankValue(card) {
    const r = card.slice(0, -1);
    if (r === 'A') return 'A';
    if (['J','Q','K'].includes(r)) return '10';
    return r;
}
function isSplittable(handObj) {
    return handObj.cards.length === 2 && rankValue(handObj.cards[0]) === rankValue(handObj.cards[1]) && playerHands.length < 4;
}
function handTotal(handObj) {
    let total = 0, aces = 0;
    handObj.cards.forEach(c => {
        let v = rankValue(c);
        if (v === 'A') { aces++; v = 11; }
        else v = parseInt(v);
        total += v;
    });
    while (total > 21 && aces--) total -= 10;
    return total;
}
function isSoftHand(handObj) {
    let total = 0, aces = 0;
    handObj.cards.forEach(c => {
        let v = rankValue(c);
        if (v === 'A') { aces++; v = 11; }
        else v = parseInt(v);
        total += v;
    });
    return aces > 0 && total - 10 * aces <= 11;
}
function getHiLoRC() {
    return seenCards.reduce((sum, c) => {
        const r = c.slice(0, -1);
        if (['2','3','4','5','6'].includes(r)) return sum + 1;
        if (['10','J','Q','K','A'].includes(r)) return sum - 1;
        return sum;
    }, 0);
}
function getTrueCount() {
    const rc = getHiLoRC();
    const decksLeft = Math.max(0.5, deck.length / 52);
    return Math.round((rc / decksLeft) * 10) / 10;
}
function getUpcardValue() {
    const up = dealerHand[0]?.slice(0, -1);
    if (!up) return null;
    if (up === 'A') return 'A';
    return (['J','Q','K'].includes(up)) ? 10 : parseInt(up);
}
function getCardImageHTML(card) {
    const suitMap = { '♠': 'spades', '♥': 'hearts', '♦': 'diamonds', '♣': 'clubs' };
    const rankMap = { 'A': 'ace', 'J': 'jack', 'Q': 'queen', 'K': 'king' };
    const r = card.slice(0, -1);
    const s = card.slice(-1);
    const fileName = `${rankMap[r] || r}_of_${suitMap[s]}.svg`.toLowerCase();
    return `<img src="cards/${fileName}" class="card-img" alt="${card}">`;
}
function getCorrectActions(handObj) {
    const hand = handObj.cards;
    const total = handTotal(handObj);
    const tc = countingEnabled ? getTrueCount() : 0;
    const up = getUpcardValue();
    const isPair = hand.length === 2 && rankValue(hand[0]) === rankValue(hand[1]);
    const rank = isPair ? rankValue(hand[0]) : null;
    const isSoft = isSoftHand(handObj);
    const basicCorrect = new Set();
    const deviationCorrect = new Set();
    if (countingEnabled) {
        if (up === 'A' && tc >= illustrious18.insurance) deviationCorrect.add('insurance');
        if (total === 16 && up === 10 && tc >= illustrious18['16vs10']) deviationCorrect.add('stand');
        if (total === 15 && up === 10 && tc >= illustrious18['15vs10']) deviationCorrect.add('stand');
        if (total === 11 && up === 'A' && tc >= illustrious18['11vsA']) deviationCorrect.add('double');
        if (total === 10 && up === 10 && tc >= illustrious18['10vs10']) deviationCorrect.add('double');
        if (total === 10 && up === 'A' && tc >= illustrious18['10vsA']) deviationCorrect.add('double');
        if (total === 12 && up === 3 && tc >= illustrious18['12vs3']) deviationCorrect.add('stand');
        if (total === 12 && up === 2 && tc >= illustrious18['12vs2']) deviationCorrect.add('stand');
        if (total === 9 && up === 2 && tc >= illustrious18['9vs2']) deviationCorrect.add('double');
        if (total === 9 && up === 7 && tc >= illustrious18['9vs7']) deviationCorrect.add('double');
        if (total === 8 && up === 6 && tc >= illustrious18['8vs6']) deviationCorrect.add('double');
        if (total === 13 && up === 2 && tc >= illustrious18['13vs2']) deviationCorrect.add('stand');
        if (total === 12 && up === 4 && tc >= illustrious18['12vs4']) deviationCorrect.add('stand');
        if (total === 12 && up === 5 && tc >= illustrious18['12vs5']) deviationCorrect.add('stand');
        if (total === 12 && up === 6 && tc >= illustrious18['12vs6']) deviationCorrect.add('stand');
        if (total === 16 && up === 9 && tc >= illustrious18['16vs9']) deviationCorrect.add('stand');
        if (isPair && rank === '10') {
            if (up === 5 && tc >= illustrious18['1010vs5']) deviationCorrect.add('stand');
            if (up === 6 && tc >= illustrious18['1010vs6']) deviationCorrect.add('stand');
        }
    }
    if (countingEnabled && surrenderEnabled && hand.length === 2) {
        if (total === 15 && up === 9 && tc >= fab4['15vs9']) deviationCorrect.add('surrender');
        if (total === 15 && up === 10 && tc >= fab4['15vs10']) deviationCorrect.add('surrender');
        if (total === 15 && up === 'A' && tc >= fab4['15vsA']) deviationCorrect.add('surrender');
        if (total === 14 && up === 10 && tc >= fab4['14vs10']) deviationCorrect.add('surrender');
    }
    if (hand.length === 2) {
        if (rank === 'A' || rank === '8') basicCorrect.add('split');
        if (rank === '9' && ![7].includes(up)) basicCorrect.add('split');
        if (rank === '7' && up <= 7) basicCorrect.add('split');
        if (rank === '6' && up <= 6) basicCorrect.add('split');
        if (rank === '4' && [5,6].includes(up) && doubleAfterSplit) basicCorrect.add('split');
        if ((rank === '3' || rank === '2') && up <= 7) basicCorrect.add('split');
        if (surrenderEnabled) {
            if (total === 16 && up >= 9) basicCorrect.add('surrender');
            if (total === 15 && up === 10) basicCorrect.add('surrender');
        }
        if (total === 11) basicCorrect.add('double');
        if (total === 10 && up <= 9) basicCorrect.add('double');
        if (total === 9 && up >= 3 && up <= 6) basicCorrect.add('double');
    }
    if (isSoft) {
        if (total >= 19) basicCorrect.add('stand');
        if (total === 18) {
            if (up <= 6) basicCorrect.add('double');
            else if (up <= 8) basicCorrect.add('stand');
            else basicCorrect.add('hit');
        }
        if (total === 17 && up <= 6) basicCorrect.add('double');
        if (total <= 16) basicCorrect.add('hit');
    } else {
        if (total >= 17) basicCorrect.add('stand');
        if (total <= 11) basicCorrect.add('hit');
        if (total >= 12 && total <= 16 && up <= 6) basicCorrect.add('stand');
        if (total >= 12 && total <= 16 && up >= 7) basicCorrect.add('hit');
    }
    return { basic: basicCorrect, deviation: deviationCorrect };
}
function updatePlayerHandsDisplay() {
    const container = document.getElementById('player-hands-container');
    container.innerHTML = '';
    playerHands.forEach((handObj, i) => {
        const div = document.createElement('div');
        div.className = 'section';
        const active = i === currentHandIndex ? ' (Active)' : '';
        div.innerHTML = `
            <h2 class="hand-label">${numSimultaneousHands > 1 ? 'Hand ' + (i+1) + active : 'Your Hand'}: ${handTotal(handObj)}</h2>
            <div class="cards">${handObj.cards.map(getCardImageHTML).join('')}</div>
        `;
        container.appendChild(div);
    });
}
function updateActionButtons() {
    const container = document.getElementById('actions');
    container.innerHTML = '';
    const handObj = playerHands[currentHandIndex];
    const { basic, deviation } = getCorrectActions(handObj);
    const allCorrect = new Set([...basic, ...deviation]);
    const actions = ['hit', 'stand', 'double', 'split', 'surrender'];
    actions.forEach(act => {
        let show = true;
        if (act === 'double') show = handObj.cards.length === 2 || (doubleAfterSplit && handObj.cards.length > 2);
        if (act === 'split') show = isSplittable(handObj);
        if (act === 'surrender') show = surrenderEnabled && handObj.cards.length === 2;
        if (show) {
            const btn = document.createElement('button');
            btn.textContent = act.charAt(0).toUpperCase() + act.slice(1);
            btn.onclick = () => playerMove(act);
            if (allCorrect.has(act)) {
                btn.classList.add('correct');
                if (deviation.has(act)) btn.classList.add('deviation');
            }
            container.appendChild(btn);
        }
    });
}
function playerMove(action) {
    const handObj = playerHands[currentHandIndex];
    const { basic, deviation } = getCorrectActions(handObj);
    const allCorrect = new Set([...basic, ...deviation]);
    totalDecisions++;
    let msg = '';
    if (allCorrect.has(action)) {
        correctDecisions++;
        msg = '✓ Correct!';
        if (deviation.has(action)) {
            msg += ' (Great deviation play!)';
        } else if (basic.has(action)) {
            msg += ' (Solid basic strategy)';
        }
        document.getElementById('feedback').style.color = 'lime';
    } else {
        msg = '✗ Wrong!';
        const correctList = [];
        if (deviation.size > 0) correctList.push(...deviation);
        correctList.push(...basic);
        msg += ` Correct: ${[...new Set(correctList)].map(a => a.toUpperCase()).join(' or ')}`;
        if (deviation.size > 0) msg += ' (Deviation opportunity missed)';
        document.getElementById('feedback').style.color = 'red';
    }
    document.getElementById('feedback').innerText = msg;
    if (action === 'hit') {
        dealCard(handObj.cards);
        if (handTotal(handObj) > 21) moveToNextHand();
    } else if (action === 'stand') {
        moveToNextHand();
    } else if (action === 'double') {
        bankroll -= handObj.bet;
        handObj.bet *= 2;
        dealCard(handObj.cards);
        moveToNextHand();
    } else if (action === 'surrender') {
        bankroll += Math.floor(handObj.bet / 2);
        moveToNextHand();
    } else if (action === 'split') {
        bankroll -= handObj.bet;
        const card = handObj.cards.pop();
        const newHand = {cards: [card], bet: handObj.bet};
        dealCard(handObj.cards);
        dealCard(newHand.cards);
        playerHands.splice(currentHandIndex + 1, 0, newHand);
        updateDisplay();
        return;
    }
    updateDisplay();
}
function moveToNextHand() {
    currentHandIndex++;
    if (currentHandIndex >= playerHands.length) {
        dealerPlay();
    } else {
        updateDisplay();
    }
}
function dealerPlay() {
    gamePhase = 'dealer';
    updateDisplay();
    const step = () => {
        const total = handTotal({cards: dealerHand});
        const soft = isSoftHand({cards: dealerHand});
        if (total < 17 || (total === 17 && soft && dealerHitsSoft17)) {
            dealCard(dealerHand);
            updateDisplay();
            setTimeout(step, 800);
        } else {
            evaluateAllHands();
        }
    };
    setTimeout(step, 800);
}
function evaluateAllHands() {
    const dTotal = handTotal({cards: dealerHand});
    playerHands.forEach(h => {
        const pTotal = handTotal(h);
        if (pTotal > 21) return;
        const isBJ = pTotal === 21 && h.cards.length === 2;
        if (isBJ && dTotal !== 21) {
            bankroll += h.bet * (1 + bjPayout);
        } else if (dTotal > 21 || pTotal > dTotal) {
            bankroll += h.bet * 2;
        } else if (pTotal === dTotal) {
            bankroll += h.bet;
        }
    });
    if (guessCountEnabled) {
        gamePhase = 'endround';
        document.getElementById('feedback').innerText = "Round over – Guess Running Count!";
    } else {
        gamePhase = 'betting';
        document.getElementById('feedback').innerText = "Round over — Deal next hand(s)";
    }
    updateDisplay();
}
function updateDisplay() {
    document.getElementById('bankroll').innerText = bankroll.toLocaleString();
    document.getElementById('decks-left').innerText = (deck.length / 52).toFixed(1);
    document.getElementById('true-count').innerText = countingEnabled ? getTrueCount() : 'N/A';
    const pct = totalDecisions === 0 ? 0 : Math.round((correctDecisions / totalDecisions) * 100);
    document.getElementById('play-accuracy').innerText = `Correct plays: ${correctDecisions}/${totalDecisions} (${pct}%)`;
    const tc = getTrueCount();
    let units = tc < 2 ? 1 : Math.floor(tc * 3);
    document.getElementById('bet-suggestion').innerText = `Suggested bet: $${baseUnit * units} (${units} units)`;
    const hideDealer = gamePhase === 'playing' || gamePhase === 'insurance';
    document.getElementById('dealer-cards').innerHTML = hideDealer
        ? `<img src="cards/back.svg" class="card-img">` + (dealerHand[0] ? getCardImageHTML(dealerHand[0]) : '')
        : dealerHand.map(getCardImageHTML).join('');
    document.getElementById('dealer-total').innerText = hideDealer ? '?' : handTotal({cards: dealerHand});
    updatePlayerHandsDisplay();
    document.getElementById('actions').style.display = gamePhase === 'playing' ? 'block' : 'none';
    document.getElementById('insurance-actions').style.display = gamePhase === 'insurance' ? 'block' : 'none';
    document.getElementById('deal-button').style.display = gamePhase === 'betting' ? 'inline-block' : 'none';
    document.getElementById('end-round').style.display = gamePhase === 'endround' ? 'block' : 'none';
    if (gamePhase === 'playing') updateActionButtons();
}
function startHand() {
    betPerHand = parseInt(document.getElementById('bet-input').value) || 25;
    if (betPerHand * numSimultaneousHands > bankroll) { alert("Insufficient funds!"); return; }
    bankroll -= betPerHand * numSimultaneousHands;
    playerHands = [];
    for (let i = 0; i < numSimultaneousHands; i++) {
        playerHands.push({cards: [], bet: betPerHand});
    }
    dealerHand = [];
    currentHandIndex = 0;
    gamePhase = 'playing';
    document.getElementById('feedback').innerText = 'Dealing...';
    playerHands.forEach(h => { dealCard(h.cards); dealCard(h.cards); });
    dealCard(dealerHand);
    dealCard(dealerHand);
    if (dealerHand[0]?.startsWith('A')) gamePhase = 'insurance';
    updateDisplay();
}
document.getElementById('insurance-yes').onclick = () => {
    const { deviation } = getCorrectActions({cards: playerHands[0].cards});
    totalDecisions++;
    if (deviation.has('insurance')) {
        correctDecisions++;
        document.getElementById('feedback').innerText = "✓ Correct insurance deviation!";
        document.getElementById('feedback').style.color = "lime";
    } else {
        document.getElementById('feedback').innerText = "✗ Wrong – no insurance needed";
        document.getElementById('feedback').style.color = "red";
    }
    bankroll -= betPerHand * numSimultaneousHands / 2;
    gamePhase = 'playing';
    updateDisplay();
};
document.getElementById('insurance-no').onclick = () => {
    const { deviation } = getCorrectActions({cards: playerHands[0].cards});
    totalDecisions++;
    if (!deviation.has('insurance')) {
        correctDecisions++;
        document.getElementById('feedback').innerText = "✓ Correct – no insurance";
        document.getElementById('feedback').style.color = "lime";
    } else {
        document.getElementById('feedback').innerText = "✗ Missed deviation – should take insurance!";
        document.getElementById('feedback').style.color = "red";
    }
    gamePhase = 'playing';
    updateDisplay();
};
document.getElementById('check-count-btn').onclick = () => {
    const actual = getHiLoRC();
    const guess = parseInt(document.getElementById('count-guess').value) || 0;
    totalCountGuesses++;
    if (guess === actual) {
        correctCountGuesses++;
        document.getElementById('count-feedback').innerText = "✓ Perfect count!";
        document.getElementById('count-feedback').style.color = "lime";
    } else {
        document.getElementById('count-feedback').innerText = `✗ Wrong – Running Count was ${actual}`;
        document.getElementById('count-feedback').style.color = "red";
    }
    const pct = Math.round((correctCountGuesses / totalCountGuesses) * 100);
    document.getElementById('count-accuracy').innerText = `${correctCountGuesses}/${totalCountGuesses} (${pct}%)`;
    setTimeout(() => {
        gamePhase = 'betting';
        document.getElementById('feedback').innerText = "Next hand ready";
        updateDisplay();
    }, 2500);
};
function applySettings() {
    numDecks = parseInt(document.getElementById('num-decks').value);
    dealerHitsSoft17 = document.getElementById('soft17').value === 'true';
    surrenderEnabled = document.getElementById('surrender').value === 'true';
    bjPayout = parseFloat(document.getElementById('bj-payout').value);
    countingEnabled = document.getElementById('counting-on').value === 'true';
    guessCountEnabled = document.getElementById('guess-count-on').value === 'true';
    doubleAfterSplit = document.getElementById('das').value === 'true';
    numSimultaneousHands = parseInt(document.getElementById('num-hands').value);
    bankroll = parseInt(document.getElementById('starting-bankroll').value) || 5000;
    document.getElementById('settings-menu').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
    createDeck();
    updateDisplay();
}
document.getElementById('settings-btn').onclick = () => {
    document.getElementById('settings-menu').style.display = 'block';
    document.getElementById('overlay').style.display = 'block';
};
document.getElementById('apply-settings-btn').onclick = applySettings;
document.getElementById('deal-button').onclick = startHand;
createDeck();
updateDisplay();
</script>
</body>
</html>
